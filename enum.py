import re

__author__ = 'Naqqash Aman'

TEMPLATE = [
    "family",
    "md5sum",
    "apis",
    "sig1_fam1",
    "sig2_fam1",
    "sig1_fam2",
    "sig2_fam2",
    "sig3_fam2",
    "sig1_fam6",
    "sig2_fam6",
    "sig1_fam7",
    "sig2_fam7",
    "sig1_fam8",
    "sig2_fam8",
    "sig3_fam8",
]

FAMILIES = {
    'banload': 1,
    'bifrose': 2,
    'buzus': 3,
    'farfli': 4,
    'small': 5,
    'swizzor': 6,
    'vundo': 7,
    'zbot': 8,
    'zlob': 9
}

SIGNATURES = {
    "banload": {
        1: {
            "api": re.compile(r'URLDownloadToFile.?'),
            "arguments": {
                "filepath": re.compile(r'c:\\windows\\.*', re.IGNORECASE)
            }
        },
        2: {
            "static": [
                re.compile(r'HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Internet Explorer\\\\Main\\\\'
                           r'FeatureControl\\\\FEATURE_VALIDATE_URLHOSTNAME')
            ]
        }
    },
    "bifrose": {
        1: {
            "api": re.compile(r"NtCreateMutant"),
            "arguments": {
                "mutant_name": re.compile(r"Bif\d+")
            }
        },
        2: {
            "api": re.compile(r"CreateDirectory.?"),
            "arguments": {
                "dirpath": re.compile(r".*Bifrost.*")
            }
        },
        3: {
            "api": re.compile(r"RegSetValue.*"),
            "arguments": {
                "regkey": re.compile(r".*Bifrost.*")
            }
        }
    },
    "swizzor": {
        1: {
            "static": [
                re.compile(r"HKEY_CURRENT_USER\\\\Software\\\\AXIS32RULE\\\\Trans Gram")
            ]
        },
        2: {
            "static": [
                re.compile(r"ayb\.host-domain-lookup\.com")
            ]
        }
    },
    "vundo": {
        1: {
            "string": re.compile(r"SysUpd|Local_SysUpdPopupMutex_%d|Local_SysUpdUpdateURLListTimer|"
                                 r"Local_SysUpdStoreURLListTimer|Local_SysUpdStoreStopAndRecoverTimer|"
                                 r"Local_SysUpdConnectTimer|Local_SysUpdUpgradeTimer|SysUpdIEProperty|"
                                 r"Local_SysUpdEmergencyUpdradeTimer|SysUpdProtectSynchronizeMutex|"
                                 r"Local_SysUpdIsRunningMutex")
        },
        2: {
            "arguments": {
                "url": re.compile(r'Cookie:root@wmvmedialease.com|http://.*:80')
            }
        }
    },
    "zbot": {
        1: {
            "api": re.compile(r'RegSetValue.*'),
            "arguments": {
                "regkey": re.compile(r'.*userinit.*')
            }
        },
        2: {
            "static": [
                re.compile(r"C:\\\\WINDOWS\\\\system32\\\\wsnpoem", re.IGNORECASE),
                re.compile(r"C:\\\\WINDOWS\\\\system32\\\\wsnpoem\\\\audio\.dll", re.IGNORECASE),
                re.compile(r"C:\\\\WINDOWS\\\\system32\\\\wsnpoem\\\\video\.dll", re.IGNORECASE)
            ]
        },
        3: {
            "static": [
                re.compile(r"\\\\?\\pipe\\__SYSTEM__64AD0625__|\\\\?\\pipe\\__SYSTEM__7F4523E5__|"
                           r"__SYSTEM__91C38905__|__SYSTEM__23D80F10__", re.IGNORECASE)
            ]
        }
    }
}
